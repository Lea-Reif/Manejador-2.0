[{"nombreConsulta":"Somimos","descripcion":"as","fecha":"2019-11-22","consulta":"holis"},{"nombreConsulta":"Papos","descripcion":"Crear tabla papo","fecha":"2020-04-30","consulta":"create table papo(\nid int)"},{"nombreConsulta":"Test","descripcion":"test","fecha":"2020-05-06","consulta":"DROP procedure IF EXISTS GanadorLoteria;\n\nDELIMITER $$\n\nCREATE PROCEDURE `GanadorLoteria`(fecha_sorteo date, _primera int ,_segunda int,_tercera int, _idloteria int,_idsorteo int)\nBEGIN\n\n\/*Declarando variables necesarias*\/\n        DECLARE v_finished INTEGER DEFAULT 0;\n  DECLARE counter BIGINT DEFAULT 0;\n        DECLARE combinacion_tiquets char(10);\n  DECLARE monto_tiquets decimal(8,2);\n        declare numeros_jugados varchar(15);\n        declare numeros_jugados_primera int;\n        declare numeros_jugados_segunda int;\n        declare numeros_jugados_tercera int;\n        declare estado_jugador char(10);\n        declare premio_jugador float;\n        declare id_jugada int;\n        declare id_loteria_2 int;\n        declare idvendedor int;\n        declare id_tiquets int;\n        \n -- declare cursor for tiquets\n DEClARE cursor_tiquets CURSOR FOR \nselect combinacion,monto,numeros,id,id_loteria2,id_vendedor,id_tiquet from jugadas where estado='PENDIENTE' and id_loteria=_idloteria \nand id_tiquet in(\n select id from tiquets where date_format(fecha,\"%Y-%m-%d\")=fecha_sorteo);\n\n \n -- declare NOT FOUND handler\n DECLARE CONTINUE HANDLER \n        FOR NOT FOUND SET v_finished = 1;\n\n OPEN cursor_tiquets;\n \n get_tiquets: LOOP\n \n FETCH cursor_tiquets INTO combinacion_tiquets,monto_tiquets,numeros_jugados,id_jugada,id_loteria_2,idvendedor,id_tiquets;\n \n IF v_finished = 1 THEN \n LEAVE get_tiquets;\n END IF;\n \/*Inicializando variables por defectos*\/\n set premio_jugador=0;\n set estado_jugador='PERDEDOR';\n \n \/*Cuando vaya por quiniela*\/\n if(combinacion_tiquets='quiniela')then\n \n \/*Si se saco en primera*\/\n if(numeros_jugados=_primera)then\n \n \/*Cuando los pagos de loterias sean por vendedor*\/\n if((select count(*) from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor)<>0)then\n set premio_jugador=(select primera*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor);\n else\n \/*Verificando el pago no sea por vendedor*\/\nSET premio_jugador= premio_jugador+(select primera*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=0);\n end if;\n\n set estado_jugador='GANADOR';\n end if;\/*Cierre del tiquet en primera*\/\n \n  \/*Si se saco en segunda*\/\n if(numeros_jugados=_segunda)then\n \n  \/*Cuando los pagos de loterias sean por vendedor*\/\n  if((select count(*) from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor)<>0)then\n  set premio_jugador=premio_jugador+(select segunda*monto_tiquets from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor);\n  else\n  \/*Verificando el pago por vendedor o no*\/\nSET premio_jugador=premio_jugador+ (select  segunda*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=0);\n  end if;\n  \n  \n   set estado_jugador='GANADOR';\n   end if;\/**Cierre del tiquet en primera*\/\n   \n    \/*Si se saco en tercera*\/\n if(numeros_jugados=_tercera)then\n \n  \/*Cuando los pagos de loterias sean por vendedor*\/\n if((select count(*) from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor)<>0)then\n  set premio_jugador=premio_jugador+(select tercera*monto_tiquets from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor);\n  \n  else\n  \/*Verificando el pago por vendedor o no*\/\nSET premio_jugador=premio_jugador+ (select tercera*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=0);\n  end if;\n   set estado_jugador='GANADOR';\n  end if;\/*Cierre del if del tique de tercera*\/\n  \n  \/*Cuando vaya por pale*\/\n elseif(combinacion_tiquets='pale')then\n set numeros_jugados_primera = substr(numeros_jugados,1,2);\n set numeros_jugados_segunda = substr(numeros_jugados,4,2);\n  \n  \/*Si el pale fue en primera y segunda*\/\nif((concat(numeros_jugados_primera,'-',n\n\nCristian Herrera Alc\u00e1ntara, [11.05.20 23:23]\numeros_jugados_segunda)=(concat(_primera,'-',_segunda) )) ||\n (concat(numeros_jugados_segunda,'-',numeros_jugados_primera)=(concat(_primera,'-',_segunda) ))||\n (concat(numeros_jugados_primera,'-',numeros_jugados_segunda)=(concat(_segunda,'-',_primera) )) ||\n (concat(numeros_jugados_segunda,'-',numeros_jugados_primera)=(concat(_segunda,'-',_primera) )) )then\n \n \/*Cuando los pagos de loterias sean por vendedor*\/\n if((select count(*) from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor)<>0)then\n set premio_jugador=premio_jugador+(select primera*monto_tiquets from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor);\n  \n  else\n  \/*Verificando el pago por vendedor o no*\/\nSET premio_jugador= premio_jugador+(select primera*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=0);\n  end if;\n  \n   set estado_jugador='GANADOR';\n   \n   \/*Si el pale fue en primera y tercera*\/\n   elseif((concat(numeros_jugados_primera,'-',numeros_jugados_segunda)=(concat(_primera,'-',_tercera) )) ||\n (concat(numeros_jugados_segunda,'-',numeros_jugados_primera)=(concat(_primera,'-',_tercera) ))||\n (concat(numeros_jugados_primera,'-',numeros_jugados_segunda)=(concat(_tercera,'-',_primera) )) ||\n (concat(numeros_jugados_segunda,'-',numeros_jugados_primera)=(concat(_tercera,'-',_primera) )) )then\n \n \/*Cuando los pagos de loterias sean por vendedor*\/\n if((select count(*) from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor)<>0)then\n set premio_jugador=premio_jugador+(select primera*monto_tiquets from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor);\n  \n  else\n  \/*Verificando el pago por vendedor o no*\/\nSET premio_jugador= premio_jugador+ (select primera*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=0);\n  end if;\n   set estado_jugador='GANADOR';\n\n   \/*Si el pale fue en segunda y tercera*\/\n      \/*Si el pale fue en primera y tercera*\/\n   elseif((concat(numeros_jugados_primera,'-',numeros_jugados_segunda)=(concat(_segunda,'-',_tercera) )) ||\n (concat(numeros_jugados_segunda,'-',numeros_jugados_primera)=(concat(_segunda,'-',_tercera) ))||\n (concat(numeros_jugados_primera,'-',numeros_jugados_segunda)=(concat(_tercera,'-',_segunda) )) ||\n (concat(numeros_jugados_segunda,'-',numeros_jugados_primera)=(concat(_tercera,'-',_segunda) )) )then\n \n \/*Cuando los pagos de loterias sean por vendedor*\/\n if((select count(*) from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor)<>0)then\n set premio_jugador=premio_jugador+(select segunda*monto_tiquets from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor);\n  \n  else\n  \/*Verificando el pago por vendedor o no*\/\nSET premio_jugador= premio_jugador+(select segunda*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=0);\n  end if;\n   set estado_jugador='GANADOR';\nend if;\/*Cierre del if de pale*\/\n\n  \/*Cuando vaya por tripleta*\/\n elseif(combinacion_tiquets='tripleta')then\n set numeros_jugados_primera = substr(numeros_jugados,1,2);\n set numeros_jugados_segunda = substr(numeros_jugados,4,2);\n set numeros_jugados_tercera = substr(numeros_jugados,7,2);\n \n \/*Cuando es tripleta entera*\/\n if((numeros_jugados_primera=_primera|| numeros_jugados_primera=_segunda || numeros_jugados_primera=_tercera) &&\n (numeros_jugados_segunda=_primera|| numeros_jugados_segunda=_segunda || numeros_jugados_segunda=_tercera) &&\n (numeros_jugados_tercera=_primera|| numeros_jugados_tercera=_segunda || numeros_jugados_tercera=_tercera))then\n \n  \/*Cuando los pagos de loterias sean por vendedor*\/\n  if((select count(*)from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor)<>0)then\n set premio_jugador=premio_jugador+(select primera*monto_tiquets from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor);\n  \n  else\n  \/*Verificando el pago por vendedor o no*\/\nSET premio_jugador= premio_jugador+(select primera*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=0);\n  end if;\n   set estado_jugador='GANADOR';\n   \n    \/*Cuando pegas dos numeros de la tripleta*\/\n   elseif(((numeros_jugados_primera=_primera||numeros_jugados_segunda=_primera||numeros_jugados_tercera=_primera)&&\n   ((numeros_jugados_primera=_segunda||numeros_jugados_segunda=_segunda||numeros_jugados_tercera=_segunda)||\n   (numeros_jugados_primera=_tercera||numeros_jugados_segunda=_tercera||numeros_jugados_tercera=_tercera))) ||\n   (numeros_jugados_primera=_segunda||numeros_jugados_segunda=_segunda||numeros_jugados_tercera=_segunda)&& \n   (numeros_jugados_primera=_tercera||numeros_jugados_segunda=_tercera||numeros_jugados_tercera=_tercera))then\n   \n     \/*Cuando los pagos de loterias sean por vendedor*\/\n  if((select count(*)from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor)<>0)then\n   set premio_jugador=premio_jugador+(select segunda*monto_tiquets from loteria_pagos \n  where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=idvendedor);\n\n  else\n  \/*Verificando el pago por vendedor o no*\/\nSET premio_jugador=premio_jugador+(select segunda*monto_tiquets from loteria_pagos\n where combinacion=combinacion_tiquets and id_loteria=_idloteria and id_vendedor=0);\n  end if;\n   set estado_jugador='GANADOR';\n   end if;\/*Cierre del if de la tripleta*\/\nend if; \/*Cierre del if de la combinacion*\/\nupdate jugadas set estado=estado_jugador,premios=premios+premio_jugador\nwhere id=id_jugada;\nupdate tiquets set idsorteo=_idsorteo where id=id_tiquets;\n END LOOP get_tiquets;\n \n CLOSE cursor_tiquets;\nEND$$\n\nDELIMITER ;"},{"nombreConsulta":"Test usuarios","descripcion":"test de tabla usuarios","fecha":"2020-11-21","consulta":"select * from usuarios;"}]